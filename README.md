# StudyCompanion

# StudyCompanion

**å°†è¯¾ç¨‹è¯¾ä»¶è½¬åŒ–ä¸ºå¯æ§é£æ ¼çš„ç»“æ„åŒ–å­¦ä¹ èµ„æ–™**

StudyCompanion æ˜¯ä¸€ä¸ªæ™ºèƒ½å­¦ä¹ åŠ©æ‰‹,èƒ½å¤Ÿè‡ªåŠ¨å°† PPT æˆ– PDF è¯¾ä»¶è½¬æ¢ä¸ºå¤šç§å½¢å¼çš„é«˜è´¨é‡å­¦ä¹ ææ–™ã€‚é€šè¿‡ AI é©±åŠ¨çš„å†…å®¹è§£æä¸ç”Ÿæˆèƒ½åŠ›,ç³»ç»Ÿè¦†ç›–ä»ä¸Šä¼ ã€è§£æã€å¤§çº²æ„å»ºåˆ°ç¬”è®°ç”Ÿæˆã€æ¨¡æ¿è¾“å‡ºã€å¯¼å‡ºå’Œé—®ç­”çš„å®Œæ•´å­¦ä¹ é—­ç¯ã€‚

---

## æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ å¤šé£æ ¼ç¬”è®°ç”Ÿæˆ

é€šè¿‡ **è¯¦ç•¥ç¨‹åº¦** Ã— **éš¾æ˜“ç¨‹åº¦** ä¸¤ä¸ªç»´åº¦çš„ç»„åˆ,ç”Ÿæˆ 9 ç§ä¸åŒé£æ ¼çš„ç»“æ„åŒ–ç¬”è®°:

- **è¯¦ç•¥ç¨‹åº¦**: `brief`(ç®€ç•¥) | `medium`(ä¸­ç­‰) | `detailed`(è¯¦ç»†)
- **éš¾æ˜“ç¨‹åº¦**: `simple`(é€šä¿—æ˜“æ‡‚) | `explanatory`(æ ‡å‡†è®²è§£) | `academic`(å­¦æœ¯æ·±å…¥)

æ¯ç§é£æ ¼éƒ½æœ‰ç‹¬ç«‹çš„ç­–ç•¥æ§åˆ¶,åŒ…æ‹¬é•¿åº¦æ¯”ä¾‹ã€æœ¯è¯­å¯†åº¦ã€å…¬å¼ä½¿ç”¨ã€å¥å¼å¤æ‚åº¦ç­‰,ç¡®ä¿è¾“å‡ºç¬¦åˆä¸åŒå­¦ä¹ åœºæ™¯éœ€æ±‚ã€‚

### ğŸ“š å¤šæ¨¡æ¿å­¦ä¹ èµ„æ–™

- **çŸ¥è¯†å¡ç‰‡**: æŒ‰ç« èŠ‚æå–æ ¸å¿ƒæ¦‚å¿µã€å…³é”®å…¬å¼å’Œç®—æ³•è¦ç‚¹,é€‚åˆå¿«é€Ÿå¤ä¹ 
- **æ¨¡æ‹Ÿè¯•é¢˜**: è‡ªåŠ¨ç”Ÿæˆé€‰æ‹©é¢˜ã€å¡«ç©ºé¢˜å’Œç®€ç­”é¢˜,é™„å‚è€ƒç­”æ¡ˆä¸è§£æ
- **æ€ç»´å¯¼å›¾**: å°†å¤§çº²è½¬åŒ–ä¸ºå¯è§†åŒ–çš„å±‚çº§ç»“æ„,æ”¯æŒå¯¼å‡ºä¸ºå›¾ç‰‡

### ğŸ” æ™ºèƒ½é—®ç­”åŠ©æ‰‹

åŸºäº RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ) æŠ€æœ¯,å¯¹å½“å‰ä¼šè¯çš„å­¦ä¹ å†…å®¹è¿›è¡Œå³æ—¶é—®ç­”,å¹¶æä¾›æº¯æºå¼•ç”¨,å¸®åŠ©ç†è§£å¤æ‚æ¦‚å¿µã€‚

### ğŸ“„ å¤šæ ¼å¼å¯¼å‡º

æ”¯æŒå°†ç”Ÿæˆçš„ç¬”è®°ã€å¡ç‰‡ã€è¯•é¢˜å¯¼å‡ºä¸º:
- **Markdown**: çº¯æ–‡æœ¬æ ¼å¼,æ˜“äºç¼–è¾‘å’Œç‰ˆæœ¬æ§åˆ¶
- **PDF**: ä¸“ä¸šæ’ç‰ˆ,åŒ…å«ç›®å½•å’Œé¡µçœ‰
- **PNG**: æ€ç»´å¯¼å›¾å›¾ç‰‡æ ¼å¼

---

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Python 3.10+
- Node.js 18+ (å¦‚éœ€è¿è¡Œå‰ç«¯)
- Google Gemini API Key æˆ– OpenAI API Key

### å®‰è£…ä¸é…ç½®

1. **å…‹éš†é¡¹ç›®å¹¶å®‰è£…ä¾èµ–**

   ```bash
   pip install -r requirements.txt
   ```

2. **é…ç½® API å¯†é’¥**

   åˆ›å»º `.env` æ–‡ä»¶å¹¶è®¾ç½®ä½ çš„ API å¯†é’¥:

   ```bash
   # ä½¿ç”¨ Google Gemini
   GOOGLE_API_KEY=your_google_api_key_here
   
   # æˆ–ä½¿ç”¨ OpenAI
   OPENAI_API_KEY=your_openai_api_key_here
   ```

3. **å¯åŠ¨åç«¯æœåŠ¡**

   ```bash
   uvicorn main:app --reload --port 8000
   ```

   æœåŠ¡å°†åœ¨ `http://localhost:8000` å¯åŠ¨ã€‚

4. **å¯åŠ¨å‰ç«¯ç•Œé¢ (å¯é€‰)**

   ```bash
   cd ui
   npm install
   npm run dev
   ```

   å‰ç«¯å°†åœ¨ `http://localhost:5173` å¯åŠ¨,å¹¶è‡ªåŠ¨ä»£ç† API è¯·æ±‚åˆ°åç«¯ã€‚

### éªŒè¯å®‰è£…

è®¿é—® `http://localhost:8000/docs` æŸ¥çœ‹ API æ–‡æ¡£,ç¡®è®¤æœåŠ¡æ­£å¸¸è¿è¡Œã€‚

---

## ä½¿ç”¨æŒ‡å—

### åŸºæœ¬å·¥ä½œæµç¨‹

StudyCompanion çš„ä½¿ç”¨éµå¾ªä»¥ä¸‹æ­¥éª¤:

```
ä¸Šä¼ è¯¾ä»¶ â†’ è§£æå†…å®¹ â†’ æ„å»ºå¤§çº² â†’ ç”Ÿæˆç¬”è®° â†’ åˆ›å»ºæ¨¡æ¿ â†’ å¯¼å‡ºèµ„æ–™
```

### 1. ä¸Šä¼ è¯¾ä»¶

ä½¿ç”¨å‰ç«¯ç•Œé¢æˆ– API ä¸Šä¼  `.pptx` æˆ– `.pdf` æ–‡ä»¶:

```bash
curl -X POST "http://localhost:8000/api/v1/files" \
  -F "file=@lecture.pdf" \
  -F "title=æœºå™¨å­¦ä¹ å¯¼è®º"
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "file_id": "file_abc123",
  "session_id": "session_xyz789"
}
```

æ¯æ¬¡ä¸Šä¼ ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯ (session),åç»­æ‰€æœ‰æ“ä½œéƒ½åŸºäºè¿™ä¸ªä¼šè¯ IDã€‚

### 2. è§£æè¯¾ä»¶å†…å®¹

**a) æå–æ–‡æœ¬å’Œç»“æ„**

```bash
curl -X POST "http://localhost:8000/api/v1/parse" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_xyz789",
    "file_id": "file_abc123",
    "file_type": "pdf"
  }'
```

**b) æ„å»ºé¡µé¢å¸ƒå±€ (ä¿ç•™å›¾ç‰‡ã€å…¬å¼ç­‰)**

```bash
curl -X POST "http://localhost:8000/api/v1/layout/build" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_xyz789",
    "file_id": "file_abc123"
  }'
```

### 3. ç”Ÿæˆç« èŠ‚å¤§çº²

ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«è¯¾ä»¶çš„å±‚çº§ç»“æ„:

```bash
curl -X POST "http://localhost:8000/api/v1/outline/build" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_xyz789"
  }'
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "id": "outline_001",
  "root": {
    "title": "æœºå™¨å­¦ä¹ å¯¼è®º",
    "children": [
      {"title": "ç¬¬ä¸€ç«  ç›‘ç£å­¦ä¹ ", "children": [...]},
      {"title": "ç¬¬äºŒç«  æ— ç›‘ç£å­¦ä¹ ", "children": [...]}
    ]
  }
}
```

### 4. ç”Ÿæˆç¬”è®°

é€‰æ‹©åˆé€‚çš„é£æ ¼ç»„åˆç”Ÿæˆç¬”è®°ã€‚ä»¥ä¸‹æ˜¯å¸¸è§åœºæ™¯çš„æ¨èé…ç½®:

| åœºæ™¯ | è¯¦ç•¥ç¨‹åº¦ | éš¾æ˜“ç¨‹åº¦ | è¯´æ˜ |
|------|---------|---------|------|
| å¿«é€Ÿå¤ä¹  | `brief` | `simple` | ç®€æ´è¦ç‚¹,é€‚åˆè€ƒå‰çªå‡» |
| æ—¥å¸¸å­¦ä¹  | `medium` | `explanatory` | æ ‡å‡†æ•™ç§‘ä¹¦é£æ ¼ |
| æ·±åº¦ç ”ç©¶ | `detailed` | `academic` | åŒ…å«å®Œæ•´æ¨å¯¼å’Œç†è®ºèƒŒæ™¯ |

> é€šè¿‡ `language` é€‰é¡¹å¯åˆ‡æ¢è¾“å‡ºè¯­è¨€ï¼š`zh`ï¼ˆé»˜è®¤ï¼Œä¸­æ–‡ï¼‰æˆ– `en`ï¼ˆè‹±æ–‡ï¼‰ã€‚å¯åœ¨ `style.language` ä¸­å£°æ˜ï¼Œä¹Ÿå¯åœ¨è¯·æ±‚ä½“é¡¶å±‚æºå¸¦ `language` å­—æ®µã€‚

**ç¤ºä¾‹: ç”Ÿæˆæ ‡å‡†è®²è§£é£æ ¼çš„ç¬”è®°**

```bash
curl -X POST "http://localhost:8000/api/v1/notes/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_xyz789",
    "outline_tree_id": "auto",
    "style": {
      "detail_level": "medium",
      "difficulty": "explanatory",
      "language": "zh"
    },
    "language": "zh"
  }'
```

**å“åº”**:
```json
{
  "task_id": "task_note_001"
}
```

ç¬”è®°ç”Ÿæˆæ˜¯å¼‚æ­¥ä»»åŠ¡,ä½¿ç”¨ task_id æŸ¥è¯¢è¿›åº¦:

```bash
# æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
curl "http://localhost:8000/api/v1/notes/tasks/task_note_001"

# æˆ–ä½¿ç”¨ SSE æµå¼è·å–è¿›åº¦
curl "http://localhost:8000/api/v1/notes/tasks/task_note_001/stream"
```

### 5. ç”Ÿæˆå­¦ä¹ æ¨¡æ¿

**a) çŸ¥è¯†å¡ç‰‡**

```bash
curl -X POST "http://localhost:8000/api/v1/cards/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_xyz789",
    "note_doc_id": "note_001"
  }'
```

**b) æ¨¡æ‹Ÿè¯•é¢˜**

```bash
curl -X POST "http://localhost:8000/api/v1/mock/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_xyz789",
    "note_doc_id": "note_001",
    "options": {
      "mode": "full",
      "size": 20,
      "difficulty": "mid"
    }
  }'
```

**c) æ€ç»´å¯¼å›¾**

```bash
curl -X POST "http://localhost:8000/api/v1/mindmap/generate" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_xyz789",
    "outline_tree_id": "outline_001"
  }'
```

### 6. å¯¼å‡ºèµ„æ–™

å°†ç”Ÿæˆçš„å†…å®¹å¯¼å‡ºä¸ºæ‰€éœ€æ ¼å¼:

```bash
curl -X POST "http://localhost:8000/api/v1/export" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_xyz789",
    "target_id": "note_001",
    "type": "notes",
    "format": "pdf"
  }'
```

**å“åº”**:
```json
{
  "download_url": "/exports/session_xyz789/notes_note_001.pdf",
  "filename": "æœºå™¨å­¦ä¹ å¯¼è®º_ç¬”è®°.pdf"
}
```

### 7. æ™ºèƒ½é—®ç­”

å¯¹å½“å‰ä¼šè¯çš„å­¦ä¹ å†…å®¹è¿›è¡Œæé—®:

```bash
curl -X POST "http://localhost:8000/api/v1/qa/ask" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "session_xyz789",
    "scope": "notes",
    "question": "ä»€ä¹ˆæ˜¯æ¢¯åº¦ä¸‹é™æ³•?"
  }'
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "answer": "æ¢¯åº¦ä¸‹é™æ³•æ˜¯ä¸€ç§ä¼˜åŒ–ç®—æ³•,é€šè¿‡è¿­ä»£åœ°æ²¿ç€ç›®æ ‡å‡½æ•°æ¢¯åº¦çš„åæ–¹å‘æ›´æ–°å‚æ•°...",
  "refs": [
    {"section": "ç¬¬ä¸€ç«  ç›‘ç£å­¦ä¹ ", "page": 5, "snippet": "...æ¢¯åº¦ä¸‹é™çš„æ•°å­¦åŸç†..."}
  ]
}
```

---

## ç®¡ç†ä¼šè¯

### æŸ¥çœ‹æ‰€æœ‰ä¼šè¯

```bash
curl "http://localhost:8000/api/v1/sessions"
```

### æŸ¥çœ‹ä¼šè¯è¯¦æƒ…

```bash
curl "http://localhost:8000/api/v1/sessions/session_xyz789"
```

ä¼šè¯è¯¦æƒ…åŒ…å«è¯¥ä¼šè¯ä¸‹æ‰€æœ‰ç”Ÿæˆçš„äº§ç‰© ID,æ–¹ä¾¿ä½ æ£€ç´¢å’Œå¯¼å‡ºã€‚

---

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

ç³»ç»Ÿæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–é»˜è®¤é…ç½®,ä½¿ç”¨ `SC__` å‰ç¼€:

```bash
# è°ƒæ•´æœ€å¤§æ–‡ä»¶å¤§å°ä¸º 150MB
export SC__LIMITS__MAX_FILE_MB=150

# è°ƒæ•´ RAG æ£€ç´¢å—å¤§å°
export SC__RAG__CHUNK__MAX_TOKENS=600
```

### é…ç½®æ–‡ä»¶

ç¼–è¾‘ `config.yaml` è‡ªå®šä¹‰ç³»ç»Ÿè¡Œä¸º:

```yaml
limits:
  max_pages: 200          # å•ä¸ªæ–‡ä»¶æœ€å¤§é¡µæ•°
  max_file_mb: 100        # ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶ (MB)

notes:
  default_detail: medium   # é»˜è®¤è¯¦ç•¥ç¨‹åº¦
  default_difficulty: explanatory  # é»˜è®¤éš¾æ˜“ç¨‹åº¦

export:
  pdf:
    header: true          # PDF æ˜¯å¦åŒ…å«é¡µçœ‰
    toc: true             # PDF æ˜¯å¦ç”Ÿæˆç›®å½•
  md:
    math_block: true      # Markdown æ˜¯å¦ä½¿ç”¨æ•°å­¦å—

rag:
  chunk:
    max_tokens: 500       # å‘é‡æ£€ç´¢çš„æ–‡æœ¬å—å¤§å°
    overlap: 50           # ç›¸é‚»å—çš„é‡å è¯æ•°
```

### LLM é…ç½®

**ä½¿ç”¨ Google Gemini (é»˜è®¤)**:
```bash
export GOOGLE_API_KEY=your_key
export GOOGLE_EMBEDDING_MODEL=models/text-embedding-004
```

**ä½¿ç”¨ OpenAI**:
```bash
export OPENAI_API_KEY=your_key
export OPENAI_EMBEDDING_MODEL=text-embedding-3-small
```

---

## é¡¹ç›®ç»“æ„

```
app/
â”œâ”€â”€ api/                    # FastAPI è·¯ç”±å®šä¹‰
â”œâ”€â”€ orchestrator/           # ä¼šè¯ç®¡ç†ä¸æµç¨‹ç¼–æ’
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ parser/            # PPT/PDF è§£æ
â”‚   â”œâ”€â”€ layout_ocr/        # é¡µé¢å¸ƒå±€è¿˜åŸ
â”‚   â”œâ”€â”€ chunk_outline/     # å¤§çº²æ„å»º
â”‚   â”œâ”€â”€ note/              # ç¬”è®°ç”Ÿæˆ (å« 9 ç§é£æ ¼ç­–ç•¥)
â”‚   â”œâ”€â”€ templates/         # å¡ç‰‡/è¯•é¢˜/æ€ç»´å¯¼å›¾ç”Ÿæˆ
â”‚   â”œâ”€â”€ exporter/          # å¤šæ ¼å¼å¯¼å‡º
â”‚   â””â”€â”€ qa/                # RAG é—®ç­”
â”œâ”€â”€ schemas/               # Pydantic æ•°æ®æ¨¡å‹
â”œâ”€â”€ storage/               # æ•°æ®åº“ä¸å‘é‡å­˜å‚¨
â”œâ”€â”€ configs/               # é…ç½®ç®¡ç†
â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°

ui/                        # React + TypeScript å‰ç«¯
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/            # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ components/       # UI ç»„ä»¶
â”‚   â””â”€â”€ api/              # API å®¢æˆ·ç«¯

doc/                       # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ éœ€æ±‚è¯´æ˜.md
â”œâ”€â”€ ç³»ç»Ÿæ¶æ„è®¾è®¡æ–‡æ¡£.md
â””â”€â”€ åŠŸèƒ½å®ç°æ–‡æ¡£.md
```

---

## æ•°æ®å­˜å‚¨

ç³»ç»Ÿä½¿ç”¨å¤šå±‚å­˜å‚¨ç­–ç•¥:

| å­˜å‚¨ç±»å‹ | ä½ç½® | ç”¨é€” |
|---------|------|------|
| SQLite | `db/study_companion.db` | ä¼šè¯å…ƒæ•°æ®ã€äº§ç‰©ç´¢å¼• |
| FAISS | `.vectors/{session_id}.faiss` | å‘é‡ç´¢å¼• (RAG æ£€ç´¢) |
| æ–‡ä»¶ç³»ç»Ÿ | `uploads/` | ä¸Šä¼ çš„åŸå§‹è¯¾ä»¶ |
| æ–‡ä»¶ç³»ç»Ÿ | `assets/{session_id}/` | è§£æå‡ºçš„å›¾ç‰‡ã€è¡¨æ ¼ |
| æ–‡ä»¶ç³»ç»Ÿ | `exports/{session_id}/` | å¯¼å‡ºçš„æ–‡æ¡£ |

---

## API å‚è€ƒ

å®Œæ•´çš„ API æ–‡æ¡£å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®:

- **Swagger UI**: `http://localhost:8000/docs`
- **ReDoc**: `http://localhost:8000/redoc`

ä¸»è¦ç«¯ç‚¹:

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/v1/files` | POST | ä¸Šä¼ è¯¾ä»¶å¹¶åˆ›å»ºä¼šè¯ |
| `/api/v1/parse` | POST | è§£æè¯¾ä»¶å†…å®¹ |
| `/api/v1/layout/build` | POST | æ„å»ºé¡µé¢å¸ƒå±€ |
| `/api/v1/outline/build` | POST | ç”Ÿæˆç« èŠ‚å¤§çº² |
| `/api/v1/notes/generate` | POST | ç”Ÿæˆç¬”è®° (å¼‚æ­¥ä»»åŠ¡) |
| `/api/v1/notes/tasks/{task_id}` | GET | æŸ¥è¯¢ç¬”è®°ç”Ÿæˆä»»åŠ¡çŠ¶æ€ |
| `/api/v1/cards/generate` | POST | ç”ŸæˆçŸ¥è¯†å¡ç‰‡ |
| `/api/v1/mock/generate` | POST | ç”Ÿæˆæ¨¡æ‹Ÿè¯•é¢˜ |
| `/api/v1/mindmap/generate` | POST | ç”Ÿæˆæ€ç»´å¯¼å›¾ |
| `/api/v1/export` | POST | å¯¼å‡ºäº§ç‰© |
| `/api/v1/qa/ask` | POST | æ™ºèƒ½é—®ç­” |
| `/api/v1/sessions` | GET | åˆ—å‡ºæ‰€æœ‰ä¼šè¯ |
| `/api/v1/sessions/{session_id}` | GET | è·å–ä¼šè¯è¯¦æƒ… |

---

## é«˜çº§ç”¨æ³•

### é£æ ¼ç­–ç•¥è‡ªå®šä¹‰

9 ç§ç¬”è®°é£æ ¼ç”± `app/modules/note/style_policies.py` å®šä¹‰ã€‚ä½ å¯ä»¥:

1. è°ƒæ•´ç°æœ‰ç­–ç•¥çš„å‚æ•° (å¦‚æœ¯è¯­å¯†åº¦ã€å¥å¼é•¿åº¦)
2. æ·»åŠ æ–°çš„é£æ ¼ç»„åˆ
3. ä¸ºç‰¹å®šå­¦ç§‘å®šåˆ¶ä¸“å±é£æ ¼

è¯¦è§ [é£æ ¼ç­–ç•¥æ–‡æ¡£](doc/åŠŸèƒ½å®ç°æ–‡æ¡£ï¼ˆFeature Implementation Docï¼‰.md)ã€‚

### æ‰¹é‡å¤„ç†

ä½¿ç”¨è„šæœ¬æ‰¹é‡ä¸Šä¼ å’Œå¤„ç†å¤šä¸ªè¯¾ä»¶:

```python
import requests

files = ["lecture1.pdf", "lecture2.pdf", "lecture3.pdf"]
for file_path in files:
    with open(file_path, "rb") as f:
        response = requests.post(
            "http://localhost:8000/api/v1/files",
            files={"file": f},
            data={"title": file_path.stem}
        )
        session_id = response.json()["session_id"]
        # ç»§ç»­åç»­å¤„ç†...
```

### å‰ç«¯é›†æˆ

å‰ç«¯é€šè¿‡ `ui/src/api/client.ts` ä¸åç«¯äº¤äº’ã€‚æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬:

- æ–‡ä»¶æ‹–æ‹½ä¸Šä¼ 
- å®æ—¶è¿›åº¦æ˜¾ç¤º (SSE æµ)
- ç« èŠ‚æ ‘å±•ç¤ºä¸å¯¼èˆª
- åœ¨çº¿é¢„è§ˆä¸ç¼–è¾‘
- æµ®åŠ¨é—®ç­”çª—å£

---

## å¸¸è§é—®é¢˜

**Q: æ”¯æŒå“ªäº›æ–‡ä»¶æ ¼å¼?**  
A: ç›®å‰æ”¯æŒ `.pptx` å’Œ `.pdf` æ ¼å¼çš„è¯¾ä»¶ã€‚

**Q: ç”Ÿæˆç¬”è®°éœ€è¦å¤šé•¿æ—¶é—´?**  
A: é€šå¸¸ 2-5 åˆ†é’Ÿ,å…·ä½“å–å†³äºè¯¾ä»¶é¡µæ•°å’Œé€‰æ‹©çš„é£æ ¼ã€‚ä½ å¯ä»¥é€šè¿‡ä»»åŠ¡ ID å®æ—¶æŸ¥è¯¢è¿›åº¦ã€‚

**Q: å¯ä»¥ä¿®æ”¹ç”Ÿæˆçš„ç¬”è®°å—?**  
A: å¯ä»¥ã€‚å¯¼å‡ºä¸º Markdown åå¯åœ¨ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨ä¸­ä¿®æ”¹,æˆ–åœ¨å‰ç«¯ç•Œé¢ç›´æ¥ç¼–è¾‘éƒ¨åˆ†å†…å®¹ã€‚

**Q: å¦‚ä½•æé«˜é—®ç­”å‡†ç¡®æ€§?**  
A: é—®ç­”åŸºäº RAG æ£€ç´¢,ç¡®ä¿å¤§çº²å’Œç¬”è®°ç”Ÿæˆå®Œæ•´ã€‚è°ƒæ•´ `config.yaml` ä¸­çš„ `chunk.max_tokens` å¯ä»¥ä¼˜åŒ–æ£€ç´¢ç²’åº¦ã€‚

**Q: æ”¯æŒå…¶ä»–è¯­è¨€å—?**  
A: ç³»ç»Ÿä¸»è¦é’ˆå¯¹ä¸­æ–‡å’Œè‹±æ–‡è¯¾ä»¶ä¼˜åŒ–,å…¶ä»–è¯­è¨€å¯èƒ½æ•ˆæœä¸ä½³ã€‚

---

## è´¡çŒ®ä¸æ”¯æŒ

æ¬¢è¿æäº¤ Issue å’Œ Pull Request!

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®,è¯·æŸ¥é˜… `doc/` ç›®å½•ä¸‹çš„è¯¦ç»†æ–‡æ¡£æˆ–è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚

---

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ª MIT è®¸å¯è¯ã€‚è¯¦è§ LICENSE æ–‡ä»¶ã€‚

## âœ¨ æ ¸å¿ƒèƒ½åŠ›

- **ç»“æ„åŒ–ç¬”è®°ç”Ÿæˆï¼ˆ9 ç§é£æ ¼ï¼‰**ï¼šè¯¦ç•¥æ¡£(`brief|medium|detailed`) Ã— éš¾æ˜“æ¡£(`simple|explanatory|academic`)ç»„åˆè¾“å‡º Markdown ç¬”è®°ï¼Œä¿ç•™ç« èŠ‚éª¨æ¶ä¸å¼•ç”¨ã€‚
- **çŸ¥è¯†å¡ç‰‡**ï¼šæŒ‰ç« èŠ‚ç”Ÿæˆæ¦‚å¿µå¡ï¼ˆå®šä¹‰ã€è€ƒç‚¹ã€ä¾‹é¢˜ï¼‰ï¼Œä¾¿äºè€ƒå‰çªå‡»ã€‚
- **æ¨¡æ‹Ÿè¯•é¢˜**ï¼šè‡ªåŠ¨æŠ½å–ç« èŠ‚è¦ç‚¹ç”Ÿæˆé€‰æ‹© / å¡«ç©º / ç®€ç­”é¢˜ï¼Œå¹¶é™„è§£æä¸å¾—åˆ†ç‚¹ã€‚
- **æ€ç»´å¯¼å›¾ / çŸ¥è¯†æ ‘**ï¼šå°†å¤§çº²è½¬åŒ–ä¸ºåˆ†å±‚å›¾ç»“æ„ï¼Œå¯å¯¼å‡º PNGã€‚
- **é¡µé¢å¼å†…å®¹è¿˜åŸ**ï¼šä¿ç•™æ ‡é¢˜ã€æ–‡æœ¬ã€å›¾ç‰‡ã€å…¬å¼å…ƒç´ åŠ captionï¼Œæ”¯æŒå›æº¯é”šç‚¹ã€‚
- **æµ®åŠ¨é—®ç­”åŠ©æ‰‹**ï¼šå¯¹å½“å‰ä¼šè¯çš„ç¬”è®°/å¡ç‰‡/è¯•é¢˜å³æ—¶æ£€ç´¢é—®ç­”ï¼Œè¿”å›æº¯æºå¼•ç”¨ã€‚
- **å¤šæ ¼å¼å¯¼å‡º**ï¼šMarkdown / PDFï¼ˆå†…å«ç›®å½•ï¼‰ã€PNGï¼ˆå¯¼å›¾ï¼‰ã€‚

## ğŸ—ï¸ æ¶æ„é€Ÿè§ˆ

```text
app/
  api/               # FastAPI å…¥å£ä¸è·¯ç”±
  orchestrator/      # è¯¾ç¨‹ä¼šè¯ç¼–æ’å™¨
  modules/
    parser/          # PPT/PDF è§£æ
    layout_ocr/      # é¡µé¢å¼è¿˜åŸä¸ caption
    chunk_outline/   # å±‚çº§åŒ–å¤§çº²
    note/            # ç¬”è®°ç”Ÿæˆ + é£æ ¼ç­–ç•¥ + RAG
    templates/       # å¡ç‰‡ / æ¨¡æ‹Ÿé¢˜ / å¯¼å›¾
    exporter/        # Markdown / PDF / PNG å¯¼å‡º
    qa/              # æµ®åŠ¨å¼é—®ç­”
  schemas/           # Pydantic å¥‘çº¦
  storage/           # SQLiteã€å‘é‡åº“ã€èµ„äº§ç®¡ç†
  configs/           # é…ç½®åŠ è½½ï¼ˆconfig.yamlï¼‰
```

> æ•°æ®æŒä¹…åŒ–ï¼šSQLiteï¼ˆå…ƒæ•°æ® + äº§ç‰©ï¼‰ + FAISSï¼ˆå‘é‡ç´¢å¼•ï¼‰ + æœ¬åœ°èµ„äº§ç›®å½•ï¼ˆå›¾ç‰‡ã€å¯¼å‡ºæ–‡ä»¶ï¼‰ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

1. **å®‰è£…ä¾èµ–**
   ```bash
   pip install -r requirements.txt
   ```

2. **å‡†å¤‡ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰**
   åœ¨ `.env.txt` ä¸­é…ç½® LLM / å‘é‡æ¨¡å‹å‚æ•°ï¼ˆé»˜è®¤ä½¿ç”¨ Google Geminiï¼›äº¦æ”¯æŒ OpenAI å…¼å®¹æ¥å£ï¼‰ã€‚

3. **å¯åŠ¨ API æœåŠ¡**
   ```bash
   uvicorn main:app --reload --port 8000 --log-level debug
   ```

4. **å¯åŠ¨å‰ç«¯å·¥ä½œå°ï¼ˆå¯é€‰ï¼‰**
   ```bash
   cd ui
   npm install
   npm run dev
   ```
   é»˜è®¤å¼€å‘ç«¯å£ä¸º `5173`ï¼Œå·²åœ¨ `vite.config.ts` ä¸­é€šè¿‡ä»£ç†æŒ‡å‘åç«¯ `http://localhost:8000` çš„ `/api` è·¯å¾„ã€‚

5. **è°ƒç”¨æµç¨‹ç¤ºä¾‹**
   ```bash
   # 1. ä¸Šä¼ æ–‡ä»¶å¹¶åˆ›å»ºä¼šè¯
   curl -X POST http://localhost:8000/api/v1/files \
        -H "Content-Type: application/json" \
        -d '{"name":"lecture.pdf","content_base64":"<BASE64>"}'

   # 2. è§£æ + ç”Ÿæˆå¤§çº²
   curl -X POST http://localhost:8000/api/v1/parse -d '{"session_id":"...","file_id":"...","file_type":"pdf"}'
   curl -X POST http://localhost:8000/api/v1/layout/build -d '{"session_id":"...","file_id":"..."}'
   curl -X POST http://localhost:8000/api/v1/outline/build -d '{"session_id":"..."}'

   # 3. ç”Ÿæˆç¬”è®°ã€å¡ç‰‡ã€æ¨¡æ‹Ÿé¢˜ã€å¯¼å›¾
   curl -X POST http://localhost:8000/api/v1/notes/generate \
        -d '{"session_id":"...","outline_tree_id":"auto","style":{"detail_level":"medium","difficulty":"explanatory","language":"zh"},"language":"zh"}'
   curl -X POST http://localhost:8000/api/v1/cards/generate -d '{"session_id":"...","note_doc_id":"note_..."}'
   curl -X POST http://localhost:8000/api/v1/mock/generate -d '{"session_id":"...","note_doc_id":"note_...","options":{"mode":"full","size":20,"difficulty":"mid"}}'
   curl -X POST http://localhost:8000/api/v1/mindmap/generate -d '{"session_id":"...","outline_tree_id":"outline_..."}'

   # 4. å¯¼å‡ºæ‰€éœ€èµ„æ–™
   curl -X POST http://localhost:8000/api/v1/export \
        -d '{"session_id":"...","target_id":"note_...","type":"notes","format":"pdf"}'

   # 5. æµ®åŠ¨é—®ç­”
   curl -X POST http://localhost:8000/api/v1/qa/ask \
        -d '{"session_id":"...","scope":"notes","question":"çº¿æ€§å›å½’çš„é€‚ç”¨æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ"}'
   ```

## ğŸ§© ä¸»è¦ API å¥‘çº¦

| è·¯å¾„ | åŠŸèƒ½ | è¯·æ±‚ä½“ | å“åº”ä½“æ ¸å¿ƒ |
| ---- | ---- | ------ | ---------- |
| `POST /api/v1/files` | ä¸Šä¼ è¯¾ä»¶ã€åˆ›å»ºä¼šè¯ | `{ name, content_base64, title? }` | `{ file_id, session_id }` |
| `POST /api/v1/parse` | PPT/PDF è§£æ | `{ session_id, file_id, file_type }` | `{ doc_meta, slides[] }` |
| `POST /api/v1/layout/build` | é¡µé¢å¼è¿˜åŸ | `{ session_id, file_id }` | `{ layout_doc }` |
| `POST /api/v1/outline/build` | ç« èŠ‚å¤§çº² | `{ session_id }` | `{ outline_tree }` |
| `POST /api/v1/notes/generate` | ç»“æ„åŒ–ç¬”è®°ï¼ˆ9 é£æ ¼ï¼‰ | `{ session_id, outline_tree_id, style, language? }` | `{ note_doc_id, note_doc }` |
| `POST /api/v1/cards/generate` | çŸ¥è¯†å¡ç‰‡ | `{ session_id, note_doc_id }` | `{ cards_id, cards }` |
| `POST /api/v1/mock/generate` | æ¨¡æ‹Ÿè¯•é¢˜ | `{ session_id, note_doc_id, options }` | `{ paper_id, paper }` |
| `POST /api/v1/mindmap/generate` | æ€ç»´å¯¼å›¾ | `{ session_id, outline_tree_id }` | `{ graph_id, graph }` |
| `POST /api/v1/export` | å¯¼å‡ºäº§ç‰© | `{ session_id, target_id, type, format }` | `{ download_url, filename }` |
| `POST /api/v1/qa/ask` | æµ®åŠ¨é—®ç­” | `{ session_id, scope, question }` | `{ answer, refs[] }` |
| `DELETE /api/v1/sessions/{session_id}` | åˆ é™¤ä¼šè¯ | `-` | `{ deleted, session_id, released_bytes }` |

è¯¦å°½å­—æ®µå®šä¹‰å‚è€ƒ `doc/åŠŸèƒ½å®ç°æ–‡æ¡£ï¼ˆFeature Implementation Docï¼‰.md` ä¸ `app/schemas/common.py`ã€‚

## âš™ï¸ é…ç½®

`config.yaml` æä¾›é»˜è®¤é™åˆ¶ï¼Œå¯ç”¨ç¯å¢ƒå˜é‡è¦†ç›–ï¼ˆå‰ç¼€ `SC__`ï¼‰ï¼š

```yaml
limits:
  max_pages: 200
  max_file_mb: 100
notes:
  default_detail: medium
  default_difficulty: explanatory
export:
  pdf:
    header: true
    toc: true
rag:
  chunk:
    max_tokens: 500
    overlap: 50
```

ç¤ºä¾‹ï¼š`SC__RAG__CHUNK__MAX_TOKENS=600` ä¼šå°†å—å¤§å°æå‡è‡³ 600 tokensã€‚

## ğŸ“¦ èµ„äº§ä¸æŒä¹…åŒ–

- ä¸Šä¼ æ–‡ä»¶ï¼š`uploads/`
- è§£æèµ„äº§ï¼ˆå›¾ç‰‡ã€è¡¨æ ¼æˆªå›¾ï¼‰ï¼š`assets/{session_id}/`
- å‘é‡ç´¢å¼•ï¼š`.vectors/{session_id}.faiss`
- å¯¼å‡ºæ–‡ä»¶ï¼š`exports/{session_id}/`
- SQLite æ•°æ®åº“ï¼š`study_companion.db`

## ğŸ§  LLM ä¸åµŒå…¥

- æ”¯æŒ `GOOGLE_API_KEY`ï¼ˆé»˜è®¤ä½¿ç”¨ Gemini 1.5 Flashï¼‰æˆ– `OPENAI_API_KEY`ã€‚
- åµŒå…¥æ¨¡å‹ç”± `GOOGLE_EMBEDDING_MODEL` æˆ– `OPENAI_EMBEDDING_MODEL` æŒ‡å®šã€‚
- æ¸©åº¦ã€æ£€ç´¢å‚æ•°ç”± `config.yaml` ä¸ API ä¾§è¯·æ±‚æ§åˆ¶ã€‚

## âœ… å¯¹é½éœ€æ±‚æ–‡æ¡£çš„å…³é”®ç‚¹

- ç«¯åˆ°ç«¯çŠ¶æ€ï¼š`UPLOADED â†’ PARSED â†’ LAYOUT_BUILT â†’ OUTLINE_READY â†’ NOTES_READY â†’ TEMPLATES_READY â†’ EXPORTED`ã€‚
- ä¸¤ç»´é£æ ¼æ§åˆ¶ä¸ 9 ç»„åˆè§„åˆ™å†™å…¥ `app/modules/note/style_policies.py`ã€‚
- æ‰€æœ‰æ¨¡æ¿äº§ç‰©ï¼ˆç¬”è®°ã€å¡ç‰‡ã€æ¨¡æ‹Ÿé¢˜ã€å¯¼å›¾ï¼‰å¯å¯¼å‡ºå¹¶æº¯æºé”šç‚¹ã€‚
- æµ®åŠ¨é—®ç­”é™å®šåœ¨å½“å‰ä¼šè¯ä¸Šä¸‹æ–‡ï¼Œè¿”å›å¼•ç”¨æ•°ç»„ã€‚

æ¬¢è¿æ ¹æ®æ–‡æ¡£ç»§ç»­æ‰©å±•å‰ç«¯æˆ–è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ ğŸ“
